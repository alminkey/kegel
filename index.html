<!doctype html><html lang="bs"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>KegelPilot — v38.2</title>
<link rel="manifest" href="manifest.json"><meta name="theme-color" content="#0B0E12">
<style>
:root{
  --bg:#0b0e12; --ink:#e0e6ef; --muted:#9aa0a6; --accent:#FFA94D; --accent2:#66E6A8; --edu:#81D4FA; --prog:#A78BFA;
  --ring-scale:.2; --ring-alpha:.3; --bgPulse-scale:.2; --bgPulse-alpha:.1; --navGlow:#66E6A8;
  --nav-h: 80px;
}
*{box-sizing:border-box} html,body{height:100%; -webkit-text-size-adjust:100%; text-size-adjust:100%} 
body{margin:0;background:radial-gradient(1200px 600px at 20% -10%,#18202b 0%,#0b0e12 60%),var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;-webkit-tap-highlight-color:transparent;
     padding-bottom: calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));}

.shell{min-height:100svh;display:grid;grid-template-rows:auto 1fr;} 

header{position:sticky;top:0;z-index:200;background:rgba(12,15,20,.85);backdrop-filter:blur(10px);
        border-bottom:1px solid rgba(255,255,255,.08);padding:10px 14px;display:flex;align-items:center;justify-content:space-between;gap:12px;}
.brandimg{height:34px} .ver{font-size:11px;color:#9aa0a6;margin-left:6px;opacity:.8} .protag{font-weight:900;letter-spacing:.2px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06)}
.protag .pro{color:#ff6b6b} .protag .on{color:#66E6A8}

main{padding:16px;display:none;overflow:auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain} main.active{display:block} .grid{display:grid;gap:12px;max-width:960px;margin:0 auto}

/* Glass cards */
.card{position:relative;border-radius:16px;padding:18px 16px;border:1px solid rgba(255,255,255,.14);overflow:hidden;cursor:pointer;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      backdrop-filter: blur(14px); box-shadow:0 12px 36px rgba(0,0,0,.4), inset 0 0 0 1px rgba(255,255,255,.05);}
.card::after{content:'';position:absolute;inset:-1px;border-radius:16px;padding:1px;background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,0)); -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite:xor; mask-composite:exclude; pointer-events:none; }
.card.has-art::before{content:'';position:absolute;inset:0;background-position:center;background-repeat:no-repeat;background-size:cover;opacity:.32;z-index:0;pointer-events:none}
.bg-level::before{background-image:url('art/card-level.svg')} .bg-edu::before{background-image:url('art/card-edu.svg')} .bg-quick::before{background-image:url('art/card-quick.svg')}
.card > *{position:relative;z-index:1}

/* Premium HERO */
.hero{position:relative;border-radius:18px;overflow:hidden;padding:22px 16px;background:
  radial-gradient(120% 120% at 10% -10%, rgba(129,212,250,.25), transparent 60%),
  radial-gradient(120% 120% at 110% 10%, rgba(102,230,168,.28), transparent 65%),
  linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.02));
border:1px solid rgba(255,255,255,.14);box-shadow:0 18px 42px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);backdrop-filter: blur(12px);}
.hero h2{margin:0 0 6px 0;font-size:clamp(20px,6vw,28px)}
.hero p{margin:0 0 12px 0;color:#b8c0cc}
.hero .cta{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:12px;border:1px solid color-mix(in sRGB, var(--accent2) 60%, white);background:var(--accent2);color:#0b0e12;font-weight:1000;letter-spacing:.3px;box-shadow:0 10px 24px color-mix(in sRGB, var(--accent2) 40%, transparent);}

/* Today summary chips */
.chips{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.chip{padding:12px 12px;border-radius:12px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);text-align:center;cursor:pointer}
.chip strong{display:block;font-weight:900}
.bar{position:relative;height:8px;background:rgba(255,255,255,.06);border-radius:999px;margin-top:6px;overflow:hidden}
.bar>div{position:absolute;inset:0 0 0 0;width:0%;background:linear-gradient(90deg, var(--accent2), #a8ffd7);border-radius:999px;}

/* Next times widget */
.widget{position:relative;border-radius:16px;padding:14px;border:1px solid rgba(255,255,255,.14);background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));box-shadow:inset 0 0 0 1px rgba(255,255,255,.05);display:flex;align-items:center;justify-content:space-between;gap:12px}
.toggle{padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.08);font-weight:900}

/* Advice */
.advice{border-radius:16px;padding:16px;border:1px solid rgba(255,255,255,.14);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));display:grid;gap:8px}
.advice .controls{display:flex;gap:8px;justify-content:flex-end;position:static !important}
.btn{appearance:none;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);padding:10px 14px;border-radius:12px;color:var(--ink);font-weight:900;letter-spacing:.3px}

/* Badges */
.badges{display:flex;gap:10px;overflow:auto;padding-bottom:4px}
.badge{min-width:92px; padding:12px;border-radius:14px;text-align:center;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.14);opacity:.6}
.badge.unlocked{opacity:1; box-shadow:0 10px 24px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.05)}
.badge svg{display:block;margin:0 auto 6px auto}

/* Bottom nav (premium ambient glow from v27) */
nav{position:fixed;left:0;right:0;bottom:0;height:var(--nav-h);z-index:200;display:grid;grid-template-columns:repeat(4,1fr);align-items:center;gap:0;
     background:linear-gradient(180deg, rgba(12,15,20,.55), rgba(12,15,20,.92)); backdrop-filter: blur(16px);
     border-top:1px solid rgba(255,255,255,.08); padding:0 10px calc(10px + env(safe-area-inset-bottom, 0px)); overflow:hidden;}
nav::before{content:'';position:absolute;left:0;right:0;top:-1px;height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);}
nav button{position:relative;appearance:none;border:0;background:transparent;color:#9aa0a6;
           border-radius:14px; padding:12px 6px; font-weight:1000; font-size:18px; display:grid; place-items:center; gap:2px;
           transform-origin:center; transition: color .2s ease, text-shadow .2s ease, transform .2s ease;}
nav button::before{content:'';position:absolute;inset:auto;left:50%;top:50%;width:76px;height:32px;border-radius:999px;transform:translate(-50%,-50%);
                   background:radial-gradient(62% 100% at 50% 50%, color-mix(in sRGB, var(--navGlow) 36%, transparent) 0%, transparent 70%);
                   filter: blur(10px); opacity:0; pointer-events:none;}
nav button.active{color:var(--ink); text-shadow:0 0 10px color-mix(in sRGB, var(--navGlow) 40%, transparent), 0 0 24px color-mix(in sRGB, var(--navGlow) 30%, transparent); transform: translateZ(0) scale(1.03);}
nav button.active::before{opacity:.9;}
nav button.active::after{content:'';width:44px;height:3px;margin-top:6px;border-radius:999px;background:var(--navGlow);box-shadow:0 0 12px color-mix(in sRGB, var(--navGlow) 45%, transparent);}

/* Lock state during training */
.app-locked main:not(#trainer){filter:blur(2px) saturate(.9) brightness(.85); pointer-events:none;}
.app-locked nav button:not([data-tab="trainer"]){pointer-events:none; opacity:.45;}
.app-locked nav button:not([data-tab="trainer"])::before{opacity:0;}

/* Trainer (same as v27 + stop button style) */
.status{font-weight:900;letter-spacing:.8px;color:var(--accent);text-align:center;text-shadow:0 2px 12px rgba(255,169,77,.25);font-size:clamp(20px,6vw,30px);}
.status.pulse{animation:pulseStatus 1.6s ease-in-out infinite;}
@keyframes pulseStatus{0%,100%{opacity:.9; transform:translateZ(0) scale(1);} 50%{opacity:1; transform:translateZ(0) scale(1.03);}}
.ring-wrap{display:grid;place-items:center;padding:12px}
.ring{position:relative;width:min(60vw,252px);height:min(60vw,252px);border-radius:50%;background:#0e131a;box-shadow:inset 0 0 0 10px rgba(255,255,255,.04),0 10px 40px rgba(0,0,0,.4);overflow:hidden;}
.bgpulse{position:absolute;inset:0;display:grid;place-items:center;z-index:0;transform:scale(var(--bgPulse-scale));}
.bgpulse > div{width:100%;height:100%;border-radius:50%;background:radial-gradient(50% 50% at 50% 50%, rgba(64,196,255, var(--bgPulse-alpha)) 0%, rgba(64,196,255,0) 70%);transition:opacity .02s linear, transform .02s linear;}
.ring .pulse-layer{position:absolute;inset:0;display:block;transform:scale(var(--ring-scale));transition:transform .02s linear;z-index:1}
.ring .stroke{stroke:#66E6A8;stroke-width:18;fill:none;opacity:var(--ring-alpha);filter:drop-shadow(0 6px 24px rgba(0,0,0,.3));}
.ring .progress-layer{position:absolute;inset:0;display:block;z-index:2} .ring .boundary{stroke:#2a3342;stroke-width:6;fill:none;opacity:.9;} .ring .progress{stroke:var(--accent);stroke-width:6;fill:none;opacity:.95;}
.startLabel{position:absolute; inset:0; display:grid; place-items:center; z-index:3; font-weight:1000; letter-spacing:1.2px; color:var(--accent); text-shadow:0 2px 14px rgba(255,169,77,.25); animation: pulseText 1.6s ease-in-out infinite; font-size:clamp(24px,7.5vw,36px);}
@keyframes pulseText{0%,100%{transform:scale(1);opacity:.9} 50%{transform:scale(1.06);opacity:1}}
.timer{text-align:center;margin-top:4px;color:var(--accent2);font-weight:800;font-size:clamp(12px,3.2vw,16px);}
.btn.stop{margin-top:8px;background:#ff6b6b;border-color:color-mix(in sRGB, #ff6b6b 60%, white);color:#0b0e12;box-shadow:0 8px 20px color-mix(in sRGB, #ff6b6b 40%, transparent);}
.hidden{display:none}

.accordion .ecard{border-radius:16px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04); overflow:hidden} .ecard header{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:14px 16px;cursor:pointer;user-select:none}
.ecard header h3{margin:0;font-size:16px} .caret{transition:transform .2s ease; opacity:.9} .ecard.open .caret{transform:rotate(90deg)}
.content{display:grid;gap:8px;padding:0 16px 14px 16px;max-height:0;overflow:hidden;transition:max-height .25s ease} .ecard.open .content{padding-top:0; max-height:600px} .muted{color:#9aa0a6}

/* Onboarding */
.ob{position:fixed;inset:0;background:rgba(5,7,10,.88);backdrop-filter:blur(10px);display:none;z-index:100}
.ob .wrap{max-width:820px;margin:0 auto;padding:20px 20px calc(20px + var(--nav-h));}
.slide{position:relative;background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.14);border-radius:18px;padding:22px;min-height:220px;box-shadow:0 16px 40px rgba(0,0,0,.45);}
.ob .controls{position:absolute;left:16px;right:16px;bottom:14px;display:flex;align-items:center;justify-content:space-between}
.btn.mint{background:var(--accent2);border-color:color-mix(in sRGB, var(--accent2) 60%, white);color:#0b0e12;box-shadow:0 8px 20px color-mix(in sRGB, var(--accent2) 40%, transparent);}
.dots{position:absolute;left:0;right:0;bottom:58px;display:flex;gap:8px;justify-content:center;align-items:center;opacity:.9}
.dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.35)}
.dot.active{background:var(--accent2); box-shadow:0 0 0 0 rgba(102,230,168,.45); animation: dotpulse 1.6s ease-in-out infinite}
@keyframes dotpulse{0%{box-shadow:0 0 0 0 rgba(102,230,168,.45)} 70%{box-shadow:0 0 0 10px rgba(102,230,168,0)} 100%{box-shadow:0 0 0 0 rgba(102,230,168,0)}}

@media (max-width: 420px){
  .chips{grid-template-columns: repeat(2,1fr);}
}
@media (max-width: 340px){
  .chips{grid-template-columns: 1fr;}
}
@media (max-height: 640px) and (orientation: portrait){
  .hero{padding:16px;}
  .hero h2{font-size:clamp(18px,5.2vw,24px)}
  .hero p{font-size:0.95rem}
}


/* --- Anti-overflow & responsive guards --- */
html, body { overflow-x: hidden; }
main { overflow-y: auto; overflow-x: hidden; }
img, svg, canvas, video { max-width: 100%; height: auto; }
.grid, .hero, .widget, .chips, .advice, .badges, .card { max-width: 100%; }
.chips { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.badges { overflow-x: auto; overflow-y: hidden; }


/* --- Stronger global anti-horizontal scroll --- */
html, body, .shell, main { width:100%; overflow-x:hidden; }
#home, #trainer, #edu, #progress { width:100%; }
.grid { width:100%; max-width:960px; margin:0 auto; }
.hero, .widget, .advice, .chips, .badges, .card { width: 100%; max-width: 100%; }
nav { max-width: 100vw; }


/* Width safety */
* { box-sizing: border-box; }
main, .grid, .hero, .widget, .chips, .advice, .badges, .card, nav { max-width: 100%; }
.chips { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.badges { overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; }
header, nav { width: 100%; max-width: 100%; }


/* Mobile safety: simplify card/hero visuals to avoid right-edge clipping on some WebViews */
@media (max-width: 480px){
  .card::after { display:none; }        /* disable mask edge */
  .hero { overflow:visible; }           /* allow inner glow without clipping text */
  .card { margin-left: 2px; margin-right: 2px; } /* small breathing space */
  main { padding-left: 12px; padding-right: 12px; }
  .grid { max-width: 640px; }
}


/* Runtime guard: when body.has 'home-compact', clamp home widths to avoid horizontal overflow */
body.home-compact #home { overflow-x: hidden; }
body.home-compact #home .grid { padding-left: 12px; padding-right: 12px; }
body.home-compact #home .hero,
body.home-compact #home .widget,
body.home-compact #home .advice,
body.home-compact #home .chips,
body.home-compact #home .badges,
body.home-compact #home .card { max-width: calc(100vw - 24px); width: 100%; margin-left: auto; margin-right: auto; }
body.home-compact nav { overflow: hidden; }


/* Content-based overflow guards (critical) */
.grid, .card, .hero, .widget, .chips, .advice, .badges, nav, header { min-width: 0; }
.grid { overflow-x: hidden; }
header > * { min-width: 0; }
nav button { min-width: 0; max-width: 100%; overflow: hidden; text-overflow: clip; white-space: nowrap; }
.chips > * { min-width: 0; }
.badges { overflow-x: auto; overflow-y: hidden; }
.badge { flex: 0 0 auto; }


/* ===== Home2: simplified, fully responsive stack (no masks, no fancy overflows) ===== */
#home.home2 { padding: 16px 12px; }
.home2 .stack { display:flex; flex-direction:column; gap:12px; width:100%; max-width:720px; margin:0 auto; }
.home2 .hero2, .home2 .card2 { width:100%; border-radius:16px; border:1px solid rgba(255,255,255,.12);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); box-shadow:0 10px 28px rgba(0,0,0,.35); padding:16px; overflow:hidden; }
.home2 .hero2 h2 { margin:0 0 6px 0; font-size:clamp(20px,6vw,28px); }
.home2 .hero2 p { margin:0 0 12px 0; color:#b8c0cc; }
.home2 .cta2 { display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:12px; border:1px solid color-mix(in sRGB, var(--accent2) 60%, white); background:var(--accent2); color:#0b0e12; font-weight:1000; letter-spacing:.3px; box-shadow:0 10px 24px color-mix(in sRGB, var(--accent2) 40%, transparent); }

.home2 .chips2 { display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px; width:100%; }
.home2 .chip2 { padding:12px; border-radius:12px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); text-align:center; }
.home2 .chip2 strong { display:block; font-weight:900; }

@media (max-width: 420px){ .home2 .chips2{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
@media (max-width: 340px){ .home2 .chips2{ grid-template-columns: 1fr; } }

.home2 .bar2 { position:relative; height:8px; background:rgba(255,255,255,.06); border-radius:999px; margin-top:6px; overflow:hidden; }
.home2 .bar2 > div { position:absolute; inset:0; width:0%; background:linear-gradient(90deg, var(--accent2), #a8ffd7); border-radius:999px; }

.home2 .row2 { display:flex; flex-direction:column; gap:12px; width:100%; }
.home2 .widget2-title { font-weight:900; }
.home2 .muted { color:#9aa0a6; }

.home2 .advice2 { display:flex; flex-direction:column; gap:8px; }
.home2 .advice2 .controls { display:flex; gap:8px; justify-content:flex-end; position:static; }
.home2 .btn2 { appearance:none; border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); padding:10px 14px; border-radius:12px; color:var(--ink); font-weight:900; letter-spacing:.3px; }

.home2 .badges2 { display:flex; gap:10px; overflow-x:auto; overflow-y:hidden; padding-bottom:4px; }
.home2 .badge2 { min-width:92px; padding:12px; border-radius:14px; text-align:center; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.14); opacity:.9; flex:0 0 auto; }


/* === KP v38.2: safe bottom space for nav === */
body{padding-bottom:72px;overflow-x:hidden}


/* === KP v38.2: Trenutni cilj (goal strip) === */
.goal-strip{margin:12px 16px 8px;border-radius:14px;border:1px solid rgba(255,255,255,.08);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); box-shadow:0 10px 22px rgba(0,0,0,.25);
  padding:12px 14px}
.goal-strip .gs-top{display:flex;align-items:baseline;justify-content:space-between;gap:8px;margin-bottom:10px}
.goal-strip .gs-title{font-weight:800;font-size:14px;color:#cfece6;letter-spacing:.3px}
.goal-strip .gs-small{font-weight:700;font-size:12px;color:#9fb9b3}
.goal-strip .gs-bar{position:relative;height:7px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
.goal-strip .gs-fill{position:absolute;left:0;top:0;bottom:0;border-radius:999px;background:linear-gradient(90deg,#19d3b1,#2dd4bf);width:0%}
.goal-strip .gs-meta{display:flex;justify-content:flex-end;font-size:12px;color:#b9c7c3;margin-top:8px}
@media (max-width:360px){
  .goal-strip{margin:10px 10px 6px;padding:10px 12px}
  .goal-strip .gs-title{font-size:13px}
  .goal-strip .gs-small,.goal-strip .gs-meta{font-size:11px}
}

</style></head>
<body>
<div class="shell">
<header>
  <div style="display:flex;align-items:center;gap:6px">
    <img id="brand" class="brandimg" alt="KegelPilot" loading="eager" fetchpriority="high" src="Logo.PNG">
    <span class="ver">v38.2</span>
  </div>
  <div class="protag"><span class="pro">PRO</span> <span class="on">aktivno</span></div>
</header>

<!-- KP v38.2: Goal strip -->
<section class="goal-strip" id="kp-goal-strip" role="status" aria-live="polite">
  <div class="gs-top">
    <span class="gs-title">Trenutni cilj</span>
    <span class="gs-small">Rang <strong id="gs-rank">1</strong> • Dan <strong id="gs-day">1</strong>/<span id="gs-max">5</span></span>
  </div>
  <div class="gs-bar"><div class="gs-fill" id="gs-fill" style="width:0%"></div></div>
  <div class="gs-meta">Danas: <b id="gs-today">0</b>/2 sesije</div>
</section>



<main id="home" class="active home2">
  <div class="stack">
    <section class="hero2">
      <h2>Treniraj pametno, napreduj sigurno</h2>
      <p>Vođene Kegel vježbe sa vizuelnim feedbackom — diskretno, efikasno i prilagođeno tebi.</p>
      <button id="ctaQuick" class="cta2">Brzi start</button>
    </section>

    <section class="chips2">
      <div id="chipDay" class="chip2"><strong id="chipDayVal">Dan 1/5</strong><span>Dan ranga</span></div>
      <div id="chipToday" class="chip2"><strong id="chipTodayVal">0/2</strong><span>Danas sesije</span><div class="bar2"><div id="chipTodayBar"></div></div></div>
      <div id="chipStreak" class="chip2"><strong id="chipStreakVal">0</strong><span>Streak (2+/dan)</span></div>
    </section>

    <section class="card2">
      <div class="widget2-title">Sljedeći termin</div>
      <div class="muted" id="nextTimesText">Danas u 10:30 i 19:00</div>
      <div style="margin-top:10px"><button id="toggleRem" class="btn2">Podsjetnici: ON</button></div>
    </section>

    <section class="card2 advice2">
      <div style="display:flex; align-items:center; justify-content:space-between">
        <strong>Savjet dana</strong>
        <div class="controls">
          <button id="advPrev" class="btn2">◀</button>
          <button id="advNext" class="btn2">▶</button>
        </div>
      </div>
      <div class="muted" id="adviceText">Diši mirno: nosom udah, ustima izdah. Izbjegavaj zadržavanje daha tokom stiska.</div>
    </section>

    <section class="card2">
      <div style="margin-bottom:8px; font-weight:900">Značke</div>
      <div id="badges" class="badges2"></div>
    </section>

    <section id="cardLevel" class="card2" role="button" tabindex="0">
      <div><strong>Tvoj nivo</strong></div>
      <div class="muted" id="homeLevelHint">Cilj: 2× dnevno • 5 dana zaredom</div>
    </section>

    <section id="cardEdu" class="card2" role="button" tabindex="0">
      <div><strong>O Kegel vježbama (za muškarce)</strong></div>
      <div class="muted">Kratko, jasno i ohrabrujuće — kako, zašto i kome pomažu.</div>
    </section>

    <section id="cardQuick" class="card2" role="button" tabindex="0">
      <div><strong>Brzi start</strong></div>
      <div class="muted">Tapni za pokretanje treninga.</div>
    </section>
  </div>
</main>
    

<main id="trainer">
  <div class="grid">
    <div class="card">
      <div id="status" class="status" style="margin-top:6px">PRIPREMI SE</div>
      <div class="ring-wrap">
        <div class="ring" id="ring" tabindex="0">
          <div class="bgpulse"><div></div></div>
          <svg class="pulse-layer" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
            <circle class="stroke" cx="50" cy="50" r="40" stroke-linecap="round"></circle>
          </svg>
          <svg class="progress-layer" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" aria-hidden="true">
            <circle class="boundary" cx="50" cy="50" r="46" stroke-linecap="round"></circle>
            <circle class="progress" cx="50" cy="50" r="46" stroke-linecap="round"></circle>
          </svg>
          <div class="startLabel" id="startLabel">START</div>
        </div>
        <div id="timer" class="timer">--:--</div>
        <button id="btnStop" class="btn stop hidden">Stop</button>
      </div>
    </div>
    <div class="card">
      <div><strong>Plan sesije</strong></div>
      <div class="muted">Rang 1 • Varijacije po danima (auto).</div>
    </div>
  </div>
</main>

<main id="edu">
  <div class="grid accordion" id="eduAcc"></div>
</main>

<main id="progress">
  <div class="grid">
    <div class="card">
      <div><strong>Sažetak</strong></div>
      <div class="kpi" id="kpiGrid"></div>
    </div>
    <div class="card">
      <div><strong>Cilj Ranga 1</strong></div>
      <div class="muted">2 sesije dnevno kroz 5 uzastopnih dana.</div>
      <div class="bar"><div id="goalDays" style="width:0%"></div></div>
      <div class="muted" id="goalDesc" style="margin-top:6px"></div>
    </div>
  </div>
</main>

<nav id="nav">
  <button class="active" data-tab="home">Početna</button>
  <button data-tab="trainer">Trening</button>
  <button data-tab="edu">Edu</button>
  <button data-tab="progress">Napredak</button>
</nav>
</div>

<div id="onb" class="ob" aria-hidden="true">
  <div class="wrap">
    <div class="slide" id="s1">
      <h3>Dobro došao u KegelPilot</h3>
      <p class="muted">Vizuelni vodič za jačanje mišića dna karlice. Diskretno, vođeno i prilagodljivo.</p>
      <div class="dots"><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div>
      <div class="controls">
        <span></span>
        <button class="btn mint" id="s1next">Dalje</button>
      </div>
    </div>
    <div class="slide" id="s2" style="display:none">
      <h3>Kako pomaže</h3>
      <p class="muted">Bolja kontrola, stabilnost core-a i podrška funkciji mokrenja. Napredak dolazi postepeno — uz dosljednost.</p>
      <div class="dots"><span class="dot"></span><span class="dot active"></span><span class="dot"></span></div>
      <div class="controls">
        <button class="btn" id="s2prev">Nazad</button>
        <button class="btn mint" id="s2next">Dalje</button>
      </div>
    </div>
    <div class="slide" id="s3" style="display:none">
      <h3>Postavi navike</h3>
      <p class="muted">Preporuka: 2 kratke sesije dnevno. Podsjetnici možeš kasnije uključiti u podešavanjima.</p>
      <div class="dots"><span class="dot"></span><span class="dot"></span><span class="dot active"></span></div>
      <div class="controls">
        <button class="btn" id="s3prev">Nazad</button>
        <button class="btn mint" id="s3done">Kreni</button>
      </div>
    </div>
  </div>
</div>

<script>
const APP_VERSION='v38.2';

(async function(){try{const saved=localStorage.getItem('kp_app_version');if(saved!==APP_VERSION){if('caches'in window){const keys=await caches.keys();await Promise.all(keys.map(k=>caches.delete(k)));}if('serviceWorker'in navigator){const regs=await navigator.serviceWorker.getRegistrations();await Promise.all(regs.map(r=>r.unregister()));}localStorage.setItem('kp_app_version',APP_VERSION);const url=new URL(window.location.href);if(!url.searchParams.get('v')){url.searchParams.set('v',APP_VERSION);window.location.replace(url.toString());}}}catch(e){}})(); 
(function(){const b=document.getElementById('brand');const i="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='132' height='28' viewBox='0 0 132 28' fill='none'><rect x='0' y='0' rx='8' ry='8' width='132' height='28' fill='rgba(15,20,27,0.85)'/><text x='14' y='19' font-family='Inter,Segoe UI,Arial,sans-serif' font-size='16' fill='%23A7F3D0' font-weight='700'>KegelPilot</text></svg>";function setInline(){b.src=i;}function tryAssets(){b.removeEventListener('error',tryAssets);b.addEventListener('error',setInline,{once:true});b.src='assets/logo_text.png';}b.addEventListener('error',tryAssets,{once:true});})();

function todayKey(){return new Date().toISOString().slice(0,10);}
function startOfDay(d){d.setHours(0,0,0,0);return d;}
function loadState(){try{return JSON.parse(localStorage.getItem('kp_state_v23')||'null')||{r1Start:todayKey(),totals:{sessions:0},days:{},remindersOn:true};}catch(e){return {r1Start:todayKey(),totals:{sessions:0},days:{},remindersOn:true};}}
function saveState(s){localStorage.setItem('kp_state_v23',JSON.stringify(s));}
const state=loadState(); if(!state.r1Start){state.r1Start=todayKey();saveState(state);}
if(typeof state.remindersOn==='undefined'){state.remindersOn=true; saveState(state);}

const tabColor = {home:'#66E6A8', trainer:'#FFA94D', edu:'#81D4FA', progress:'#A78BFA'};

(function(){
  const pages=document.querySelectorAll('main');
  const navButtons=document.querySelectorAll('nav button');
  function showTab(id){
    pages.forEach(p=>p.classList.toggle('active',p.id===id));
    navButtons.forEach(b=>b.classList.toggle('active', b.getAttribute('data-tab')===id));
    document.documentElement.style.setProperty('--navGlow', tabColor[id]||'#66E6A8');
    if (navigator.vibrate) navigator.vibrate(12);
  }
  navButtons.forEach(btn=>btn.addEventListener('click',e=>{e.preventDefault(); if(document.body.classList.contains('app-locked')) return; showTab(btn.getAttribute('data-tab'));}));
  document.getElementById('cardLevel').addEventListener('click',()=> { if(!document.body.classList.contains('app-locked')) showTab('progress'); });
  document.getElementById('cardEdu').addEventListener('click',()=> { if(!document.body.classList.contains('app-locked')) showTab('edu'); });
  document.getElementById('cardQuick').addEventListener('click',()=> showTab('trainer'));
  document.getElementById('ctaQuick').addEventListener('click',()=> showTab('trainer'));
  showTab('home');
})();

function dayIndexFromStart(){const a=startOfDay(new Date(state.r1Start));const b=startOfDay(new Date());return Math.max(1,Math.min(5,Math.round((b-a)/86400000)+1));}
function markSessionComplete(){const k=todayKey();state.days[k]=(state.days[k]||0)+1;state.totals.sessions++;saveState(state);renderHome();renderProgress();}
function renderHome(){
  const k=todayKey();const today=state.days[k]||0;const dayIdx=dayIndexFromStart();
  document.getElementById('chipDayVal').textContent='Dan '+dayIdx+'/5';
  document.getElementById('chipTodayVal').textContent=today+'/2';
  const bar = document.getElementById('chipTodayBar'); bar.style.width = Math.min(100, (today/2)*100)+'%';
  // streak calc
  let streak=0;for(let i=0;i<30;i++){const d=new Date();d.setDate(d.getDate()-i);const key=d.toISOString().slice(0,10);const c=state.days[key]||0;if(c>=2)streak++;else break;}
  document.getElementById('chipStreakVal').textContent=streak;
  // next times text (placeholder)
  const nextText = state.remindersOn ? 'Danas u 10:30 i 19:00' : 'Podsjetnici su isključeni';
  document.getElementById('nextTimesText').textContent = nextText;
  document.getElementById('toggleRem').textContent = 'Podsjetnici: ' + (state.remindersOn? 'ON':'OFF');
  document.getElementById('homeLevelHint').textContent=`Dan ${dayIdx} • Danas: ${today}/2 sesije`;
  renderBadges(streak, today);
}
function renderProgress(){
  const k=todayKey();const today=state.days[k]||0;const dayIdx=dayIndexFromStart();
  let streak=0;for(let i=0;i<30;i++){const d=new Date();d.setDate(d.getDate()-i);const key=d.toISOString().slice(0,10);const c=state.days[key]||0;if(c>=2)streak++;else break;}
  let daysCompleted=0;for(let i=0;i<5;i++){const d=new Date(startOfDay(new Date(state.r1Start)));d.setDate(d.getDate()+i);const key=d.toISOString().slice(0,10);if((state.days[key]||0)>=2)daysCompleted++;}
  const total=state.totals.sessions||0;
  const grid=document.getElementById('kpiGrid'); if(!grid) return;
  grid.innerHTML='';
  const mk=(label,val)=>`<div class="box"><div class="big">${val}</div><div class="small">${label}</div></div>`;
  grid.insertAdjacentHTML('beforeend', mk('Dan ranga', dayIdx));
  grid.insertAdjacentHTML('beforeend', mk('Danas sesije', today+'/2'));
  grid.insertAdjacentHTML('beforeend', mk('Uzastopni dani (2+/dan)', streak));
  grid.insertAdjacentHTML('beforeend', mk('Ukupno sesija', total));
  const pct=Math.round((daysCompleted/5)*100);
  const goalDays = document.getElementById('goalDays'); if(goalDays) goalDays.style.width=pct+'%';
  const goalDesc = document.getElementById('goalDesc'); if(goalDesc) goalDesc.textContent=`Završeni dani: ${daysCompleted}/5 (potrebno 5/5 sa 2 sesije dnevno)`;
}
renderHome(); renderProgress();

// Advice slider
(function(){
  const adv=[
    "Diši mirno: nosom udah, ustima izdah. Ne zadržavaj dah.",
    "Intenzitet stiska neka bude umjeren (50–70%) — kvalitet ispred sile.",
    "Ne stiskaj stomak, bedra ili stražnjicu — fokus je isključivo dno karlice.",
    "Ako osjetiš zamor, skrati trajanje i drži tehniku čistu.",
    "Dosljednost pobjeđuje. Dvije kratke sesije dnevno su bolje od jedne preduge."
  ];
  let i=Number(localStorage.getItem('kp_adv_idx')||'0')%adv.length;
  const el=document.getElementById('adviceText');
  function show(){ el.textContent=adv[i]; localStorage.setItem('kp_adv_idx', String(i)); }
  document.getElementById('advPrev').onclick=()=>{ i=(i-1+adv.length)%adv.length; show(); };
  document.getElementById('advNext').onclick=()=>{ i=(i+1)%adv.length; show(); };
  show();
})();

// Badges
function badgeSvg(color="#66E6A8"){
  return `<svg width="40" height="40" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs><radialGradient id="g" cx=".5" cy=".5" r=".7">
      <stop offset="0" stop-color="${color}" stop-opacity=".9"/><stop offset="1" stop-color="${color}" stop-opacity=".2"/>
    </radialGradient></defs>
    <circle cx="24" cy="24" r="20" fill="url(#g)"/><circle cx="24" cy="24" r="18" fill="none" stroke="rgba(255,255,255,.26)"/>
  </svg>`;
}
function renderBadges(streak, today){
  const total=state.totals.sessions||0;
  const dayIdx=dayIndexFromStart();
  const list=[
    {id:'b1', label:'Prva sesija', unlocked: total>=1, color:'#66E6A8'},
    {id:'b2', label:'3 dana zaredom', unlocked: streak>=3, color:'#81D4FA'},
    {id:'b3', label:'10 sesija', unlocked: total>=10, color:'#FFA94D'},
    {id:'b4', label:'Danas 2/2', unlocked: today>=2, color:'#A78BFA'},
    {id:'b5', label:'Rang 1 završen', unlocked: (()=>{let done=0; for(let i=0;i<5;i++){const d=new Date(startOfDay(new Date(state.r1Start)));d.setDate(d.getDate()+i);const key=d.toISOString().slice(0,10);if((state.days[key]||0)>=2)done++;} return done>=5;})(), color:'#66E6A8'}
  ];
  const host=document.getElementById('badges'); host.innerHTML='';
  list.forEach(b=>{
    const div=document.createElement('div');
    div.className='badge'+(b.unlocked?' unlocked':'');
    div.innerHTML = badgeSvg(b.color) + `<div style="font-size:12px;margin-top:4px">${b.label}</div>`;
    host.appendChild(div);
  });
}

// Reminders toggle (placeholder state)
document.getElementById('toggleRem').onclick=()=>{ if(document.body.classList.contains('app-locked')) return; state.remindersOn=!state.remindersOn; saveState(state); renderHome(); };

// Chips tap
document.getElementById('chipDay').onclick=()=>{ if(document.body.classList.contains('app-locked')) return; document.querySelector('nav button[data-tab="progress"]').click(); };
document.getElementById('chipToday').onclick=()=>{ if(document.body.classList.contains('app-locked')) return; document.querySelector('nav button[data-tab="progress"]').click(); };
document.getElementById('chipStreak').onclick=()=>{ if(document.body.classList.contains('app-locked')) return; document.querySelector('nav button[data-tab="progress"]').click(); };

// Trainer logic (same as v27 with STOP + lock)
(function(){
  const R=46,C=2*Math.PI*R;
  const progress=document.querySelector('.progress-layer .progress');
  progress.setAttribute('stroke-dasharray',C.toFixed(2));
  progress.setAttribute('stroke-dashoffset',C.toFixed(2));
  progress.setAttribute('transform','rotate(-90 50 50)');
  const ring=document.getElementById('ring');
  const status=document.getElementById('status');
  const startLabel=document.getElementById('startLabel');
  const timerEl=document.getElementById('timer');
  const btnStop=document.getElementById('btnStop');

  const VARS={1:{hold:1,keep:0,rest:2},2:{hold:1,keep:1,rest:1},3:{hold:0.5,keep:3,rest:2}};
  function planForDay(d){const total=30;if(d<=2)return[{var:1,reps:total}];if(d===3||d===4)return[{var:1,reps:total/2},{var:2,reps:total/2}];return[{var:1,reps:10},{var:2,reps:10},{var:3,reps:10}];}
  function totalDuration(segments){let s=0;segments.forEach(x=>{const v=VARS[x.var];s+=x.reps*(v.hold+v.keep+v.rest);});return s;}
  function fmt(sec){sec=Math.max(0,Math.ceil(sec));const m=String(Math.floor(sec/60)).padStart(2,'0');const s=String(sec%60).padStart(2,'0');return m+':'+s;}

  let running=false,raf=0,last=0,session=null;
  function setStatusPhase(phase){ if(phase==='preroll'){ status.textContent='PRIPREMI SE'; status.classList.add('pulse'); } else if(phase==='hold'){ status.textContent='STEGNI'; status.classList.remove('pulse'); } else if(phase==='keep'){ status.textContent='ZADRŽI'; status.classList.remove('pulse'); } else if(phase==='rest'){ status.textContent='OPUSTI'; status.classList.remove('pulse'); } else { status.textContent='PRIPREMI SE'; status.classList.remove('pulse'); } }
  function setProgress(p){progress.setAttribute('stroke-dashoffset',(C*(1-p)).toFixed(2));}
  function apply(m){document.documentElement.style.setProperty('--ring-scale',m.ring.toFixed(3));document.documentElement.style.setProperty('--bgPulse-scale',m.bg.toFixed(3));document.documentElement.style.setProperty('--ring-alpha',m.ra.toFixed(3));document.documentElement.style.setProperty('--bgPulse-alpha',m.ba.toFixed(3));}
  function resetVisual(){ apply({ring:.2,bg:.2,ra:.3,ba:.1}); setProgress(0); timerEl.textContent='--:--'; setStatusPhase('idle'); startLabel.style.display='grid'; }

  function buildSession(){const d=dayIndexFromStart();const segs=planForDay(d).map(s=>Object.assign({},s));const tot=totalDuration(segs);return {segments:segs,seg:0,rep:1,phase:'preroll',remain:2,elapsed:0,total:tot,totalLeft:tot};}

  function loop(ts){
    if(!running) return;
    if(!last) last=ts; const dt=(ts-last)/1000; last=ts;
    session.remain -= dt;
    if(session.phase==='preroll'){
      const t = Math.min(1, Math.max(0, (2-session.remain)/2));
      setProgress(t);
      apply({ring:.25+.15*t, bg:.25+.15*t, ra:.5+.3*t, ba:.18+.12*t});
      setStatusPhase('preroll');
      timerEl.textContent='--:--';
      if(session.remain<=0){
        setProgress(0);
        const seg = session.segments[session.seg]; const v = VARS[seg.var];
        session.phase='hold'; session.remain=v.hold; setStatusPhase('hold');
      }
    } else {
      const seg=session.segments[session.seg]; const v=VARS[seg.var];
      const phaseLen=session.phase==='hold'?v.hold:session.phase==='keep'?v.keep:session.phase==='rest'?v.rest:0;
      const elapsedPhase=(phaseLen-session.remain);
      const t=Math.min(1,Math.max(0,elapsedPhase/phaseLen));
      apply(session.phase==='hold'?{ring:.2+.8*t,bg:.2+.8*t,ra:.3+.7*t,ba:.1+.4*t}:session.phase==='keep'?{ring:1,bg:1,ra:.95,ba:.5-.2*t}:{ring:1-.8*t,bg:1-.8*t,ra:1-.7*t,ba:.5-.4*t});
      session.elapsed += dt;
      session.totalLeft = Math.max(0, session.total - session.elapsed);
      setProgress(Math.min(1, session.elapsed/session.total));
      timerEl.textContent = fmt(session.totalLeft);
      if(session.remain<=0){
        if(session.phase==='hold'){ if(v.keep>0){ session.phase='keep'; session.remain=v.keep; setStatusPhase('keep'); } else { session.phase='rest'; session.remain=v.rest; setStatusPhase('rest'); } }
        else if(session.phase==='keep'){ session.phase='rest'; session.remain=v.rest; setStatusPhase('rest'); }
        else { session.rep++; if(session.rep>seg.reps){ session.seg++; session.rep=1; if(session.seg>=session.segments.length){ return finish(true); } } const nv=VARS[session.segments[session.seg].var]; session.phase='hold'; session.remain=nv.hold; setStatusPhase('hold'); }
      }
    }
    raf=requestAnimationFrame(loop);
  }

  function lockUI(lock){ document.body.classList.toggle('app-locked', !!lock); }
  function start(){ if(running) return; session=buildSession(); last=0; running=true; startLabel.style.display='none'; setStatusPhase('preroll'); document.querySelector('nav button[data-tab="trainer"]').click(); document.body.classList.add('app-locked'); document.getElementById('btnStop').classList.remove('hidden'); raf=requestAnimationFrame(loop); }
  function finish(success){ running=false; cancelAnimationFrame(raf); document.getElementById('btnStop').classList.add('hidden'); lockUI(false); resetVisual(); if(success) markSessionComplete(); }

  document.getElementById('startLabel').addEventListener('click', (e)=>{ e.preventDefault(); start(); });
  document.getElementById('ring').addEventListener('click', (e)=>{ e.preventDefault(); start(); });
  document.getElementById('btnStop').addEventListener('click', (e)=>{ e.preventDefault(); finish(false); });

  resetVisual();
})(); // trainer

// EDU accordion (unchanged)
(function(){
  const data = [
 ["Šta su Kegel vježbe?","Dno karlice je skup mišića koji idu od trtične do stidne kosti. Ti mišići podržavaju mokraćni mjehur, prostatu i rektum te pomažu u kontroli mokrenja i seksualnoj funkciji. Kegel vježbe su jednostavne kontrakcije ovih mišića s ciljem jačanja i bolje kontrole."],
 ["Zašto rade?","Jačanjem dna karlice poboljšava se mehanička podrška i kontrola sfinktera, a često i stabilnost erekcije. Istraživanja pokazuju koristi za kontrolu mokrenja, erektilnu funkciju i neke oblike preranog svršavanja — posebno uz dosljedno vježbanje."],
 ["Kom je ovo korisno?","• muškarcima sa slabijom erekcijom ili prijevremenom ejakulacijom\n• nakon operacije prostate (za curenje mokraće)\n• kod curenja pri kašljanju/kihanju/podizanju tereta\n• svima koji žele bolju kontrolu i stabilnost core-a"],
 ["Ko treba pauzirati i prvo se javiti doktoru?","Pauziraj i posavjetuj se ako imaš hroničan bol u karlici/preponama, bol pri erekciji/ejakulaciji/orgazmu, učestalo i hitno mokrenje, izražen zatvor, svježu infekciju urinarnog trakta ili ako si nedavno operisan."],
 ["Kako ‘naći’ pravi mišić","Kao da želiš zaustaviti mlaz mokraće ili spriječiti vjetar — to je otprilike pravi osjećaj. Ovo koristi samo kao test; ne vježbaj redovno tokom mokrenja. Ne stiskaj stomak, stražnjicu ni bedra i ne zadržavaj dah."],
 ["Osnovna tehnika u aplikaciji","U KegelPilotu prati STEGNI → (ponekad ZADRŽI) → OPUSTI. Pulsirajući prsten te vodi kroz stisak i opuštanje, a narandžasta traka pokazuje napredak cijele sesije. Intenzitet neka bude umjeren (50–70%), uz mirno disanje."],
 ["Šta kažu studije","Pregledi više studija pokazuju poboljšanja erektilne funkcije, kontrole mokrenja i često kod preranog svršavanja, posebno uz redovnost i/ili rad s fizioterapeutom za dno karlice. Napredak je postepen i zahtijeva dosljednost."],
 ["Česte greške","• Prejak stisak i zamor — biraj umjereno.\n• Stiskanje stražnjice/stomaka/bedara — fokus na dno karlice.\n• Zadržavanje daha — diši mirno.\n• Previše serija prerano — drži se plana u appu."],
 ["Plan i motivacija","Kreni s Rangom 1; aplikacija te vodi i postepeno uvodi varijacije. Cilj za prelazak: 2 sesije dnevno kroz 5 uzastopnih dana. Mnogi promjene primijete kroz nekoliko sedmica — strpljenje i kontinuitet su ključ."],
 ["Napomena","Ovaj sadržaj je informativan i ne zamjenjuje savjet ljekara. Ako imaš simptome koji te brinu ili osjetiš pogoršanje tokom vježbi, stani i potraži stručni savjet."]
];
  const host = document.getElementById('eduAcc');
  data.forEach((item, idx)=>{
    const [title, body] = item;
    const card = document.createElement('section'); card.className='ecard';
    const id = 'ec'+idx;
    card.innerHTML = `<header role="button" aria-controls="${id}-content" aria-expanded="false" tabindex="0"><h3>${title}</h3><svg class="caret" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M8 5v14l11-7z"/></svg></header><div id="${id}-content" class="content"><div class="muted" style="white-space:pre-line">${body}</div></div>`;
    function toggle(open){ card.classList.toggle('open', open); const h = card.querySelector('header'); h.setAttribute('aria-expanded', open? 'true':'false'); }
    card.querySelector('header').addEventListener('click', ()=>{ if(document.body.classList.contains('app-locked')) return; const isOpen = card.classList.contains('open'); document.querySelectorAll('.ecard.open').forEach(el=>el.classList.remove('open')); toggle(!isOpen); });
    card.querySelector('header').addEventListener('keydown', (e)=>{ if(document.body.classList.contains('app-locked')) return; if(e.key==='Enter' || e.key===' ') { e.preventDefault(); card.querySelector('header').click(); } });
    host.appendChild(card);
  });
})();

(function(){
  const onb = document.getElementById('onb');
  const done = localStorage.getItem('kp_onboard_v23_done')==='1';
  if(!done){ onb.style.display='block'; }
  function show(n){ ['s1','s2','s3'].forEach((id,i)=>{ document.getElementById(id).style.display = (i===n-1?'block':'none'); }); }
  document.getElementById('s1next').onclick=()=>show(2);
  document.getElementById('s2prev').onclick=()=>show(1);
  document.getElementById('s2next').onclick=()=>show(3);
  document.getElementById('s3prev').onclick=()=>show(2);
  document.getElementById('s3done').onclick=()=>{ localStorage.setItem('kp_onboard_v23_done','1'); onb.style.display='none'; };
})();

if('serviceWorker' in navigator){ window.addEventListener('load', function(){ navigator.serviceWorker.register('./service-worker.js?v='+APP_VERSION); }); }
</script>

<script>
// KP Step0: pre-flight flags (no UI). Safe to keep if not used.
(function(){
  try {
    var DEF = { newHome:false, newProgress:false };
    var raw = localStorage.getItem('kp_flags');
    if (raw) {
      var cur = {};
      try { cur = JSON.parse(raw) || {}; } catch(e){ cur = {}; }
      localStorage.setItem('kp_flags', JSON.stringify(Object.assign({}, DEF, cur)));
    } else {
      localStorage.setItem('kp_flags', JSON.stringify(DEF));
    }
    // Track last deployed version
    localStorage.setItem('kp_last_version', 'v38.2.0-preflight');
  } catch(e){ /* no-op */ }
})();
</script>


<script>
// KP v38.2: Goal strip logic (non-invasive)
(function(){
  try{
    var LS = localStorage;
    var rank = +(LS.getItem('kp_rank')||1);
    var day = +(LS.getItem('kp_rank_day')||1);
    var max = +(LS.getItem('kp_rank_len')||5);
    var today = +(LS.getItem('kp_sessions_today')||0);
    // clamp
    rank = Math.max(1, rank|0);
    day = Math.min(max, Math.max(1, day|0));
    today = Math.max(0, Math.min(2, today|0));
    // Fill UI
    var $ = function(id){ return document.getElementById(id); }
    if($('gs-rank')) $('gs-rank').textContent = rank;
    if($('gs-day')) $('gs-day').textContent = day;
    if($('gs-max')) $('gs-max').textContent = max;
    if($('gs-today')) $('gs-today').textContent = today;
    // Progress: završeni dani (pretpostavimo da je dan završen kada je today>=2)
    var done = (day-1) + (today>=2 ? 1 : 0);
    var pct = Math.max(0, Math.min(100, Math.round(done/max*100)));
    var fill = $('gs-fill'); if(fill) fill.style.width = pct + '%';
  }catch(e){ console.warn('goal-strip', e); }
})();
</script>

</body></html>
